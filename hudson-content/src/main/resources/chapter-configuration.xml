<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
"http://www.sonatype.com/tmp/docbook/xml/4.5/docbookx.dtd">
<chapter>
  <title>Configuring Hudson</title>

    <para>To configure Hudson, click on the Manage Hudson link in the
    left-hand navigation menu. Clicking Manage Hudson will display the screen
    shown in <xref linkend="fig-using-manage-matrix" />. This section will
    focus on two links on this page, Configure System and Manage
    Plugins.</para>

    <figure id="fig-using-manage-matrix">
      <title>Managing Hudson</title>

      <mediaobject>
        <imageobject role="web">
          <imagedata contentdepth="100%"
                     fileref="figs/web/ci-using-manage-matrix.png"
                     scalefit="1" />
        </imageobject>

        <imageobject role="print">
          <imagedata align="center"
                     fileref="figs/print/ci-using-manage-matrix.pdf"
                     scalefit="0" width="100%" />
        </imageobject>
      </mediaobject>
    </figure>

    <para>Depending on the plugins installed and activated on your Hudson
      system different sections will be available in the system configuration
      section. These will either be explained below or with a plugin specific
      section. E.g. the source code management related plugin configurations
      can be found in XREF.
    </para>
  <!-- TODO xref-->

  <section>
    <title>Global Hudson Configuration</title>

    <para>When you are configuring the Hudson system, click on Configure
    System in the screen shown in <xref
    linkend="fig-using-manage-matrix" />. The first configuration section
    contains options that allow you to configure global Hudson configuration
    attributes. This section is shown in <xref
    linkend="fig-using-global-config" />.</para>

    <figure id="fig-using-global-config">
      <title>Configuring Global Hudson Configuration</title>

      <mediaobject>
        <imageobject role="web">
          <imagedata contentdepth="100%"
                     fileref="figs/web/ci-using-global-config.png"
                     scalefit="1" />
        </imageobject>

        <imageobject role="print">
          <imagedata align="center"
                     fileref="figs/print/ci-using-global-config.pdf"
                     scalefit="0" width="100%" />
        </imageobject>
      </mediaobject>
    </figure>

    <variablelist>
      <varlistentry>
        <term>Home Directory</term>

        <listitem>
          <para>This is not a configurable parameter it is something that is
          set by the server on startup.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>System Message</term>

        <listitem>
          <para>This is just a global system message that is displayed by
          Hudson.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term># of Executors</term>

        <listitem>
          <para>This parameter controls the number of executors that can execute
            concurrent Hudson builds.
          </para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>Quiet period</term>
        <listitem>
          <para></para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>SCM checkout retry count</term>
        <listitem>
          <para></para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>Enable Security</term>
        <listitem>
          <para></para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>Prevent Cross Site Request Forgery exploits</term>
        <!-- wtf .. why is this here.. should be on all the time and not
        configurable unless there is a very good reason
        -->
        <listitem>
          <para></para>
        </listitem>
      </varlistentry>


      <varlistentry>
        <term>Help make Hudson better...</term>
        <listitem>
          <para></para>
        </listitem>
      </varlistentry>


    </variablelist>
  </section>

  <section>
    <title>Global Properties Configuration</title>
  </section>

  <section>
    <title>Configuring JDK Installations</title>

    <para>Hudson can support one or more JDK installations. To configure a
    JDK installation, find the JDK section of the server configuration
    screen. To add a new JDK installation click on Add JDK in the screen
    shown in <xref linkend="fig-using-jdk-config" />.

      <!-- TODO document unselecting install automatically and provide path
      for using existing install and then document new install -->
      Supply a name for a
    JDK installation and then do one of two things: either supply the
    directory for JAVA_HOME or select Install Automatically.</para>

    <figure id="fig-using-jdk-config">
      <title>Configuring JDK Installations</title>

      <mediaobject>
        <imageobject role="web">
          <imagedata contentdepth="100%"
                     fileref="figs/web/ci-using-jdk-config.png" scalefit="1" />
        </imageobject>

        <imageobject role="print">
          <imagedata align="center"
                     fileref="figs/print/ci-using-jdk-config.pdf"
                     scalefit="0" width="100%" />
        </imageobject>
      </mediaobject>
    </figure>

    <para>Clicking on "Install automatically" will expose a drop down which
    will let you choose a specific version of JDK to download and install
    from Oracle. Once you configure Hudson to download and install the JDK
    automatically, Hudson will wait for the first build which is configured
    to use a named instance of the JDK to initiate the JDK download and
    installation.</para>
  </section>

  <section>
    <title>Configuring Ant Installations</title>

    <!-- TODO replicate documentation from jdk, maven..
  </section>

  <section>
     <title>Configuring Maven Installations</title>
                    -->
     <para>Hudson is designed with a special level of support for Maven
     builds. To use Maven, you must figure configure a Hudson Maven
     installation. To do this, go to the Maven section of the server
     configuration. You can configure one or more installations of Maven, to
     do so, click on the Add Maven button as shown in <xref
     linkend="fig-using-maven-config" />. Then assign your new created Maven
     installation a name which will be displayed in project configuration
     select lists.</para>

    <!-- TODO improve like JDK install-->

     <figure id="fig-using-maven-config">
       <title>Configuring Maven Installations</title>
       <!-- TODO update screenshot to have Maven 3.0.3 and not a beta version -->
       <mediaobject>
         <imageobject role="web">
           <imagedata contentdepth="100%"
                      fileref="figs/web/ci-using-maven-config.png"
                      scalefit="1" />
         </imageobject>

         <imageobject role="print">
           <imagedata align="center"
                      fileref="figs/print/ci-using-maven-config.pdf"
                      scalefit="0" width="100%" />
         </imageobject>
       </mediaobject>
     </figure>

     <para>To install a version of Maven automatically from the Apache
     Software Foundation, select "Install Automatically" and then click on
     "Add Installer". Clicking on Add Installer will bring up a list of Maven
     versions available to install. We recommend that you run your build
     using the latest Maven 3.0 release. At this point, Maven will not be
     automatically downloaded and installed. Instead, Hudson will initiate a
     Maven installation the first time a build is run which requires
     Maven.

     <!-- TODO MM document configuring already installed maven version via path -->
     </para>
   </section>

  <section>
    <title>Configuring the Shell Executable</title>

    <para>Hudson allows for the ability to configure Shell builds. If you
    have a build which requires the execution of bash script or a csh
    script, you can configure which interpreter is used to execute shell
    scripts in this configuration variable.</para>

    <figure id="fig-using-shell-execute">
      <title>Configuring Shell Executable</title>

      <mediaobject>
        <imageobject role="web">
          <imagedata contentdepth="100%"
                     fileref="figs/web/ci-using-shell-execute.png"
                     scalefit="1" />
        </imageobject>

        <imageobject role="print">
          <imagedata align="center"
                     fileref="figs/print/ci-using-shell-execute.pdf"
                     scalefit="0" width="100%" />
        </imageobject>
      </mediaobject>
    </figure>
  </section>


    <section>
      <title>Configuring E-mail Notification</title>
      <!-- TODO there should be more and better docu here for this critical
      feature.. -->

      <para>Email notification is a core feature of a continuous integration
      server, and you can configure the way in which Hudson will connect to an
      SMTP server in the Email Notification section of the server
      configuration screen. In this form you can configure an SMTP server, a
      default user e-mail suffix which is appended to build usernames. You can
      set the administrative email address, and the URL to be used in emails
      which link back to the Hudson UI.</para>

      <figure id="fig-using-email-notify">
        <title>Configuring Email Notification</title>

        <mediaobject>
          <imageobject role="web">
            <imagedata contentdepth="100%"
                       fileref="figs/web/ci-using-email-notify.png"
                       scalefit="1" />
          </imageobject>

          <imageobject role="print">
            <imagedata align="center"
                       fileref="figs/print/ci-using-email-notify.pdf"
                       scalefit="0" width="100%" />
          </imageobject>
        </mediaobject>
      </figure>

      <para>In addition to basic SMTP configuration parameters, it is also
      possible to configure Hudson to use SMTP auth to send email through
      local services which require secure credentials for sending email or
      public services such as Gmail. To configure these parameters, populate
      the User Name, Password, SSL, SMTP Port parameters. Once you have
      completed the SMTP configuration, click on "Test configuration" to send
      a test email to the administrator email address.</para>
    </section>

  <!-- TODO this is not there by default, what triggers it (which plugin)
  and therefore where should it be documented.. maybe here anyway but with a
  remark..
  -->
  <section>
    <title>Configuring SCM Polling Concurrency</title>

    <para>This is a simple, global parameter to Hudson which controls the number
      of concurrent threads to be used when polling an SCM system. Most CI
      systems discover code changes in an SCM by continuously polling source
      control. If you have enough project configured, this polling can grow to
      become a significant factor in SCM performance. If you are suffering
      performance issues because you have configured hundreds of projects to
      poll SCM, you can use this one property to define concurrency limits on
      Hudson's ability to concurrently poll an SCM.
    </para>

    <figure id="fig-using-scm-poll">
      <title>Configuring SCM Polling Concurrency</title>

      <mediaobject>
        <imageobject role="web">
          <imagedata contentdepth="100%"
                     fileref="figs/web/ci-using-scm-poll.png" scalefit="1"/>
        </imageobject>

        <imageobject role="print">
          <imagedata align="center" fileref="figs/print/ci-using-scm-poll.pdf"
                     scalefit="0" width="100%"/>
        </imageobject>
      </mediaobject>
    </figure>
  </section>
</chapter>
